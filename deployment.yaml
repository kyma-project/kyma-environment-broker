{
    "apiVersion": "apps/v1",
    "kind": "Deployment",
    "metadata": {
        "creationTimestamp": "2023-08-23T12:44:34Z",
        "labels": {
            "app.kubernetes.io/instance": "kcp",
            "app.kubernetes.io/managed-by": "Helm",
            "app.kubernetes.io/name": "kyma-environment-broker-lj",
            "app.kubernetes.io/version": "0.1.0",
            "helm.sh/chart": "kyma-environment-broker-0.1.0"
        },
        "name": "kcp-kyma-environment-broker-lj",
        "namespace": "kcp-system",
        "resourceVersion": "2736737428",
        "uid": "c7a7f3c7-5ceb-4b31-b973-219c35cb89e2"
    },
    "spec": {
        "progressDeadlineSeconds": 600,
        "replicas": 1,
        "revisionHistoryLimit": 10,
        "selector": {
            "matchLabels": {
                "app.kubernetes.io/instance": "kcp",
                "app.kubernetes.io/name": "kyma-environment-broker-lj"
            }
        },
        "strategy": {
            "rollingUpdate": {
                "maxSurge": "50%",
                "maxUnavailable": "0%"
            },
            "type": "RollingUpdate"
        },
        "template": {
            "metadata": {
                "annotations": {
                    "checksum/config": "79fc63de1d77697a8a08b5f93c6318e7d98f365c3fb8987ef4da47d7a435619a",
                    "istio-operator.kyma-project.io/restartedAt": "2023-10-04T09:12:47Z",
                    "kubectl.kubernetes.io/restartedAt": "2023-11-01T15:24:28Z"
                },
                "creationTimestamp": null,
                "labels": {
                    "app.kubernetes.io/instance": "kcp",
                    "app.kubernetes.io/name": "kyma-environment-broker-lj"
                }
            },
            "spec": {
                "containers": [
                    {
                        "env": [
                            {
                                "name": "APP_BROKER_REGION_PARAMETER_IS_REQUIRED",
                                "value": "false"
                            },
                            {
                                "name": "APP_BROKER_ALLOW_NETWORKING_PARAMETERS",
                                "value": "true"
                            },
                          {
                            "name": "APP_BROKER_ALLOW_MODULES_PARAMETERS",
                            "value": "true"
                          },
                            {
                                "name": "APP_DISABLE_PROCESS_OPERATIONS_IN_PROGRESS",
                                "value": "true"
                            },
                            {
                                "name": "APP_BROKER_ENABLE_PLANS",
                                "value": "azure,gcp,azure_lite,trial,aws,openstack,free,own_cluster,preview"
                            },
                            {
                                "name": "APP_BROKER_ONLY_SINGLE_TRIAL_PER_GA",
                                "value": "false"
                            },
                            {
                                "name": "APP_BROKER_URL",
                                "value": "kyma-env-broker.cp.dev.kyma.cloud.sap"
                            },
                            {
                                "name": "APP_BROKER_ENABLE_KUBECONFIG_URL_LABEL",
                                "value": "true"
                            },
                            {
                                "name": "APP_BROKER_INCLUDE_ADDITIONAL_PARAMS_IN_SCHEMA",
                                "value": "true"
                            },
                            {
                                "name": "APP_BROKER_SHOW_TRIAL_EXPIRATION_INFO",
                                "value": "true"
                            },
                            {
                                "name": "APP_BROKER_SUBACCOUNTS_IDS_TO_SHOW_TRIAL_EXPIRATION_INFO",
                                "value": "all"
                            },
                            {
                                "name": "APP_BROKER_TRIAL_DOCS_URL",
                                "value": "https://help.sap.com/docs/BTP/65de2977205c403bbc107264b8eccf4b/57074a0ee7244880b0dfa0563e1de3a8.html"
                            },
                            {
                                "name": "APP_OPERATION_TIMEOUT",
                                "value": "7h"
                            },
                            {
                                "name": "APP_RECONCILER_URL",
                                "value": "http://kcp-mothership-reconciler.kcp-system.svc.cluster.local"
                            },
                            {
                                "name": "APP_LIFECYCLE_MANAGER_INTEGRATION_DISABLED",
                                "value": "false"
                            },
                            {
                                "name": "APP_RECONCILER_INTEGRATION_DISABLED",
                                "value": "false"
                            },
                            {
                                "name": "APP_RECONCILER_PROVISIONING_TIMEOUT",
                                "value": "2h"
                            },
                            {
                                "name": "APP_PROVISIONER_URL",
                                "value": "http://kcp-provisioner.kcp-system.svc.cluster.local:3000/graphql"
                            },
                            {
                                "name": "APP_PROVISIONER_PROVISIONING_TIMEOUT",
                                "value": "6h"
                            },
                            {
                                "name": "APP_PROVISIONER_DEPROVISIONING_TIMEOUT",
                                "value": "5h"
                            },
                            {
                                "name": "APP_PROVISIONER_OPENSTACK_FLOATING_POOL_NAME",
                                "value": "FloatingIP-external-cp-kyma"
                            },
                            {
                                "name": "APP_PROVISIONER_DEFAULT_GARDENER_SHOOT_PURPOSE",
                                "value": "development"
                            },
                            {
                                "name": "APP_PROVISIONER_DEFAULT_TRIAL_PROVIDER",
                                "value": "AWS"
                            },
                            {
                                "name": "APP_PORT",
                                "value": "8080"
                            },
                            {
                                "name": "APP_STATUS_PORT",
                                "value": "8071"
                            },
                            {
                                "name": "APP_DIRECTOR_DEFAULT_TENANT",
                                "value": "3e64ebae-38b5-46a0-b1ed-9ccee153a0ae"
                            },
                            {
                                "name": "APP_DIRECTOR_URL",
                                "value": "https://compass-gateway-auth-oauth.mps.dev.kyma.cloud.sap/director/graphql"
                            },
                            {
                                "name": "APP_DIRECTOR_OAUTH_TOKEN_URL",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "tokens_endpoint",
                                        "name": "kcp-kyma-environment-broker-credentials",
                                        "optional": true
                                    }
                                }
                            },
                            {
                                "name": "APP_DIRECTOR_OAUTH_CLIENT_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "client_id",
                                        "name": "kcp-kyma-environment-broker-credentials",
                                        "optional": true
                                    }
                                }
                            },
                            {
                                "name": "APP_DIRECTOR_OAUTH_CLIENT_SECRET",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "client_secret",
                                        "name": "kcp-kyma-environment-broker-credentials",
                                        "optional": true
                                    }
                                }
                            },
                            {
                                "name": "APP_DIRECTOR_OAUTH_SCOPE",
                                "value": "runtime:read runtime:write"
                            },
                            {
                                "name": "APP_IAS_URL",
                                "value": "TBD"
                            },
                            {
                                "name": "APP_IAS_USER_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "id",
                                        "name": "ias-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_IAS_USER_SECRET",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "secret",
                                        "name": "ias-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_IAS_IDENTITY_PROVIDER",
                                "value": "TBD"
                            },
                            {
                                "name": "APP_IAS_DISABLED",
                                "value": "true"
                            },
                            {
                                "name": "APP_IAS_TLS_RENEGOTIATION_ENABLE",
                                "value": "false"
                            },
                            {
                                "name": "APP_IAS_TLS_SKIP_CERT_VERIFICATION",
                                "value": "false"
                            },
                            {
                                "name": "APP_EDP_AUTH_URL",
                                "value": "https://auth.yevents.io"
                            },
                            {
                                "name": "APP_EDP_ADMIN_URL",
                                "value": "https://admin.yevents.io"
                            },
                            {
                                "name": "APP_EDP_NAMESPACE",
                                "value": "kyma-dev"
                            },
                            {
                                "name": "APP_EDP_ENVIRONMENT",
                                "value": "dev"
                            },
                            {
                                "name": "APP_EDP_REQUIRED",
                                "value": "false"
                            },
                            {
                                "name": "APP_EDP_DISABLED",
                                "value": "false"
                            },
                            {
                                "name": "APP_EDP_SECRET",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "secret",
                                        "name": "edp-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_SECRET_KEY",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "secretKey",
                                        "name": "kcp-storage-client-secret",
                                        "optional": true
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_USER",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "postgresql-broker-username",
                                        "name": "kcp-postgresql"
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_PASSWORD",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "postgresql-broker-password",
                                        "name": "kcp-postgresql"
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_HOST",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "postgresql-serviceName",
                                        "name": "kcp-postgresql"
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_PORT",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "postgresql-servicePort",
                                        "name": "kcp-postgresql"
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_NAME",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "postgresql-broker-db-name",
                                        "name": "kcp-postgresql"
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_SSLMODE",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "postgresql-sslMode",
                                        "name": "kcp-postgresql"
                                    }
                                }
                            },
                            {
                                "name": "APP_DATABASE_SSLROOTCERT",
                                "value": "/secrets/cloudsql-sslrootcert/server-ca.pem"
                            },
                            {
                                "name": "APP_AVS_OAUTH_TOKEN_ENDPOINT",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "oauthTokenEndpoint",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_OAUTH_USERNAME",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "oauthUserName",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_OAUTH_PASSWORD",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "oauthPassword",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_API_ENDPOINT",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "apiEndpoint",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_OAUTH_CLIENT_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "clientId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_API_KEY",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "apiKey",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_INTERNAL_TESTER_ACCESS_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "internalTesterAccessId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_EXTERNAL_TESTER_ACCESS_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "externalTesterAccessId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_INTERNAL_TESTER_SERVICE",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "internalTesterService",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_EXTERNAL_TESTER_SERVICE",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "externalTesterService",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_GROUP_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "groupId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_PARENT_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "parentId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_TRIAL_API_KEY",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "trialApiKey",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_TRIAL_INTERNAL_TESTER_ACCESS_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "trialInternalTesterAccessId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_TRIAL_GROUP_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "trialGroupId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_TRIAL_PARENT_ID",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "trialParentId",
                                        "name": "avs-creds"
                                    }
                                }
                            },
                            {
                                "name": "APP_AVS_INSTANCE_ID_TAG_CLASS_ID",
                                "value": "320334701"
                            },
                            {
                                "name": "APP_AVS_GLOBAL_ACCOUNT_ID_TAG_CLASS_ID",
                                "value": "320339941"
                            },
                            {
                                "name": "APP_AVS_SUB_ACCOUNT_ID_TAG_CLASS_ID",
                                "value": "320336838"
                            },
                            {
                                "name": "APP_AVS_LANDSCAPE_TAG_CLASS_ID",
                                "value": "151"
                            },
                            {
                                "name": "APP_AVS_REGION_TAG_CLASS_ID",
                                "value": "320340750"
                            },
                            {
                                "name": "APP_AVS_PROVIDER_TAG_CLASS_ID",
                                "value": "320340965"
                            },
                            {
                                "name": "APP_AVS_SHOOT_NAME_TAG_CLASS_ID",
                                "value": "314006844"
                            },
                            {
                                "name": "APP_AVS_MAINTENANCE_MODE_DURING_UPGRADE_DISABLED",
                                "value": "false"
                            },
                            {
                                "name": "APP_AVS_MAINTENANCE_MODE_DURING_UPGRADE_ALWAYS_DISABLED_GLOBAL_ACCOUNTS_FILE_PATH",
                                "value": "/config/avsMaintenanceModeDuringUpgradeAlwaysDisabledGlobalAccountIDs.yaml"
                            },
                            {
                                "name": "APP_KYMA_VERSION",
                                "value": "2.19.3"
                            },
                            {
                                "name": "APP_ENABLE_ON_DEMAND_VERSION",
                                "value": "true"
                            },
                            {
                                "name": "APP_MANAGED_RUNTIME_COMPONENTS_YAML_FILE_PATH",
                                "value": "/config/additionalRuntimeComponents.yaml"
                            },
                            {
                                "name": "APP_TRIAL_REGION_MAPPING_FILE_PATH",
                                "value": "/config/trialRegionMapping.yaml"
                            },
                            {
                                "name": "APP_EU_ACCESS_WHITELISTED_GLOBAL_ACCOUNTS_FILE_PATH",
                                "value": "/config/euAccessWhitelistedGlobalAccountIds.yaml"
                            },
                            {
                                "name": "APP_EU_ACCESS_REJECTION_MESSAGE",
                                "value": "Due to limited availability, you need to open support ticket before attempting to provision Kyma clusters in EU Access only regions"
                            },
                            {
                                "name": "APP_FREEMIUM_PROVIDERS",
                                "value": "aws,azure"
                            },
                            {
                                "name": "APP_CATALOG_FILE_PATH",
                                "value": "/config/catalog.yaml"
                            },
                            {
                                "name": "APP_GARDENER_PROJECT",
                                "value": "kyma-dev"
                            },
                            {
                                "name": "APP_GARDENER_SHOOT_DOMAIN",
                                "value": "dev.kyma.ondemand.com"
                            },
                            {
                                "name": "APP_GARDENER_KUBECONFIG_PATH",
                                "value": "/gardener/kubeconfig/kubeconfig"
                            },
                            {
                                "name": "APP_KUBECONFIG_ISSUER_URL",
                                "value": "https://kymatest.accounts400.ondemand.com"
                            },
                            {
                                "name": "APP_KUBECONFIG_CLIENT_ID",
                                "value": "9bd05ed7-a930-44e6-8c79-e6defeb7dec9"
                            },
                            {
                                "name": "APP_KUBECONFIG_ALLOW_ORIGINS",
                                "value": "https://dashboard.dev.kyma.cloud.sap"
                            },
                            {
                                "name": "APP_PROVISIONER_KUBERNETES_VERSION",
                                "value": "1.26"
                            },
                            {
                                "name": "APP_PROVISIONER_MACHINE_IMAGE",
                                "value": "gardenlinux"
                            },
                            {
                                "name": "APP_PROVISIONER_MACHINE_IMAGE_VERSION",
                                "value": "934.10.0"
                            },
                            {
                                "name": "APP_PROVISIONER_TRIAL_NODES_NUMBER",
                                "value": "1"
                            },
                            {
                                "name": "APP_PROVISIONER_AUTO_UPDATE_KUBERNETES_VERSION",
                                "value": "true"
                            },
                            {
                                "name": "APP_PROVISIONER_AUTO_UPDATE_MACHINE_IMAGE_VERSION",
                                "value": "false"
                            },
                            {
                                "name": "APP_PROVISIONER_MULTI_ZONE_CLUSTER",
                                "value": "true"
                            },
                            {
                                "name": "APP_PROVISIONER_CONTROL_PLANE_FAILURE_TOLERANCE"
                            },
                            {
                                "name": "APP_DEFAULT_REQUEST_REGION",
                                "value": "cf-eu10"
                            },
                            {
                                "name": "APP_UPDATE_PROCESSING_ENABLED",
                                "value": "true"
                            },
                            {
                                "name": "APP_NOTIFICATION_URL",
                                "value": "TBD"
                            },
                            {
                                "name": "APP_NOTIFICATION_DISABLED",
                                "value": "true"
                            },
                            {
                                "name": "APP_VERSION_CONFIG_NAMESPACE",
                                "value": "kcp-system"
                            },
                            {
                                "name": "APP_VERSION_CONFIG_NAME",
                                "value": "kyma-versions"
                            },
                            {
                                "name": "APP_DOMAIN_NAME",
                                "value": "cp.dev.kyma.cloud.sap"
                            },
                            {
                                "name": "APP_SKR_OIDC_DEFAULT_VALUES_YAML_FILE_PATH",
                                "value": "/config/skrOIDCDefaultValues.yaml"
                            },
                            {
                                "name": "APP_SKR_DNS_PROVIDERS_VALUES_YAML_FILE_PATH",
                                "value": "/config/skrDNSProvidersValues.yaml"
                            },
                            {
                                "name": "APP_ORCHESTRATION_CONFIG_NAMESPACE",
                                "value": "kcp-system"
                            },
                            {
                                "name": "APP_ORCHESTRATION_CONFIG_NAME",
                                "value": "orchestration-config"
                            },
                            {
                                "name": "APP_NEW_ADDITIONAL_RUNTIME_COMPONENTS_YAML_FILE_PATH",
                                "value": "/config/newAdditionalRuntimeComponents.yaml"
                            },
                            {
                                "name": "APP_PROFILER_MEMORY",
                                "value": "false"
                            },
                            {
                                "name": "APP_KYMA_DASHBOARD_CONFIG_LANDSCAPE_URL",
                                "value": "https://dashboard.dev.kyma.cloud.sap"
                            },
                            {
                                "name": "APP_EVENTS_ENABLED",
                                "value": "true"
                            }
                        ],
                        "image": "europe-docker.pkg.dev/kyma-project/dev/kyma-environment-broker:PR-101",
                        "imagePullPolicy": "Always",
                        "livenessProbe": {
                            "failureThreshold": 3,
                            "httpGet": {
                                "path": "/healthz",
                                "port": 8071,
                                "scheme": "HTTP"
                            },
                            "initialDelaySeconds": 30,
                            "periodSeconds": 10,
                            "successThreshold": 1,
                            "timeoutSeconds": 3
                        },
                        "name": "kyma-environment-broker",
                        "ports": [
                            {
                                "containerPort": 8080,
                                "name": "http",
                                "protocol": "TCP"
                            }
                        ],
                        "readinessProbe": {
                            "failureThreshold": 3,
                            "httpGet": {
                                "path": "/healthz",
                                "port": 8071,
                                "scheme": "HTTP"
                            },
                            "initialDelaySeconds": 10,
                            "periodSeconds": 5,
                            "successThreshold": 1,
                            "timeoutSeconds": 2
                        },
                        "resources": {
                            "limits": {
                                "cpu": "1",
                                "memory": "4Gi"
                            },
                            "requests": {
                                "cpu": "100m",
                                "memory": "512Mi"
                            }
                        },
                        "terminationMessagePath": "/dev/termination-log",
                        "terminationMessagePolicy": "File",
                        "volumeMounts": [
                            {
                                "mountPath": "/gardener/kubeconfig",
                                "name": "gardener-kubeconfig",
                                "readOnly": true
                            },
                            {
                                "mountPath": "/config",
                                "name": "config-volume"
                            },
                            {
                                "mountPath": "/swagger/schema",
                                "name": "swagger-volume"
                            }
                        ]
                    },
                    {
                        "command": [
                            "/cloud_sql_proxy",
                            "-instances=sap-ti-dx-kyma-mps-dev:europe-west1:kyma-mps-dev-9fe8=tcp:5432"
                        ],
                        "image": "europe-docker.pkg.dev/kyma-project/prod/tpi/cloudsql-docker/gce-proxy:v1.33.8-afb993b8",
                        "imagePullPolicy": "IfNotPresent",
                        "name": "cloudsql-proxy",
                        "resources": {},
                        "securityContext": {
                            "runAsUser": 2000
                        },
                        "terminationMessagePath": "/dev/termination-log",
                        "terminationMessagePolicy": "File"
                    }
                ],
                "dnsPolicy": "ClusterFirst",
                "nodeSelector": {
                    "pool-type": "app"
                },
                "restartPolicy": "Always",
                "schedulerName": "default-scheduler",
                "securityContext": {
                    "runAsUser": 2000
                },
                "serviceAccount": "kcp-kyma-environment-broker",
                "serviceAccountName": "kcp-kyma-environment-broker",
                "terminationGracePeriodSeconds": 30,
                "volumes": [
                    {
                        "configMap": {
                            "defaultMode": 420,
                            "name": "kcp-kyma-environment-broker"
                        },
                        "name": "config-volume"
                    },
                    {
                        "configMap": {
                            "defaultMode": 420,
                            "name": "kcp-kyma-environment-broker-swagger"
                        },
                        "name": "swagger-volume"
                    },
                    {
                        "name": "gardener-kubeconfig",
                        "secret": {
                            "defaultMode": 420,
                            "secretName": "gardener-credentials"
                        }
                    }
                ]
            }
        }
    }
}
